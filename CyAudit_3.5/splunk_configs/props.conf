# CyAudit Splunk Configuration - props.conf
# Version: 1.0
# Purpose: Field extraction and sourcetype definitions for CyAudit data

################################################################################
# Global Settings for All CyAudit Sourcetypes
################################################################################

[cyaudit:*]
# Encoding and line breaking
CHARSET = UTF-8
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)
TRUNCATE = 100000

# JSON parsing - search-time extraction (KV_MODE)
KV_MODE = json
JSON_TRIM_BRACES_IN_ARRAY_NAMES = true

# Timestamp extraction from @timestamp field
TIME_PREFIX = "@timestamp"\s*:\s*"
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3N%Z
MAX_TIMESTAMP_LOOKAHEAD = 32

# Field aliases for CIM compliance
FIELDALIAS-host = computer_name AS host
FIELDALIAS-src_host = computer_name AS src
FIELDALIAS-dest_host = computer_name AS dest

################################################################################
# System Information Sourcetypes
################################################################################

[cyaudit:systeminfo]
# System configuration and identification
EVAL-category = "system_info"
EVAL-vendor_product = "Microsoft Windows"

[cyaudit:versioninfo]
# Windows version details
EVAL-category = "system_info"
EVAL-os = ProductName

################################################################################
# Identity & Access Management
################################################################################

[cyaudit:users]
# User account information
FIELDALIAS-user = UserName AS user
FIELDALIAS-user_category = UserName AS src_user
EVAL-category = "identity"
EVAL-account_status = case(AccountDisabled="true", "disabled", AccountLocked="true", "locked", 1=1, "active")
EVAL-has_password_expiration = if(PasswordExpires="null" OR PasswordExpires="", "false", "true")

[cyaudit:groups]
# Group membership
FIELDALIAS-group = Name AS group
FIELDALIAS-group_name = Name AS group_name
EVAL-category = "identity"
EVAL-has_members = if(member_count>0, "true", "false")

################################################################################
# Security Policies
################################################################################

[cyaudit:passwordpolicies]
# Password policy settings
EVAL-category = "security_policy"
EVAL-policy_type = "password"

[cyaudit:auditpolicies]
# Audit policy configuration
EVAL-category = "security_policy"
EVAL-policy_type = "audit"
EVAL-audit_enabled = case(Setting="Success and Failure", "full", Setting="Success", "partial", Setting="Failure", "partial", Setting="No auditing", "disabled", 1=1, "unknown")

[cyaudit:userrights]
# User rights assignments
EVAL-category = "security_policy"
EVAL-policy_type = "user_rights"
EVAL-has_assignees = if(assignee_count>0, "true", "false")

################################################################################
# Registry & Configuration
################################################################################

[cyaudit:registry]
# Registry values
EVAL-category = "configuration"
EVAL-config_type = "registry"
EVAL-key_exists = if(ValueName="Registry key does not exist", "false", "true")

[cyaudit:stig_registry]
# STIG registry compliance
EVAL-category = "compliance"
EVAL-compliance_framework = "DISA_STIG_V33_Registry"
EVAL-severity = case(match(STIG_ID, "CAT1"), "critical", match(STIG_ID, "CAT2"), "high", match(STIG_ID, "CAT3"), "medium", 1=1, "informational")

################################################################################
# Services & Features
################################################################################

[cyaudit:services]
# Windows services
FIELDALIAS-service = ServiceName AS service
FIELDALIAS-service_name = DisplayName AS service_display_name
EVAL-category = "configuration"
EVAL-config_type = "service"
EVAL-is_running = if(service_status="running", "true", "false")
EVAL-auto_start = if(StartMode="Auto", "true", "false")

[cyaudit:features]
# Windows features
EVAL-category = "configuration"
EVAL-config_type = "feature"
EVAL-is_installed = if(feature_status="installed", "true", "false")

################################################################################
# File System Permissions
################################################################################

[cyaudit:filepermissions]
# File ACLs
FIELDALIAS-path = FilePath AS file_path
FIELDALIAS-account = IdentityReference AS account
FIELDALIAS-account_name = IdentityReference AS src_user
EVAL-category = "permissions"
EVAL-object_type = "file"
EVAL-permission_type = AccessControlType
EVAL-is_inherited = if(IsInherited="true", "true", "false")

[cyaudit:dirpermissions]
# Directory ACLs
FIELDALIAS-path = DirectoryPath AS directory_path
FIELDALIAS-account = IdentityReference AS account
FIELDALIAS-account_name = IdentityReference AS src_user
EVAL-category = "permissions"
EVAL-object_type = "directory"
EVAL-permission_type = AccessControlType
EVAL-is_inherited = if(IsInherited="true", "true", "false")

################################################################################
# Storage & Patching
################################################################################

[cyaudit:drives]
# Disk drive information
FIELDALIAS-drive = DriveLetter AS drive
EVAL-category = "storage"
EVAL-storage_type = DriveType

[cyaudit:hotfixes]
# Installed updates
FIELDALIAS-patch_id = HotFixID AS patch_id
FIELDALIAS-update_id = HotFixID AS update_id
EVAL-category = "patching"
EVAL-patch_status = "installed"

[cyaudit:missinghotfixes]
# Missing updates
FIELDALIAS-patch_id = KBNum AS patch_id
FIELDALIAS-update_id = KBNum AS update_id
EVAL-category = "patching"
EVAL-patch_status = "missing"
EVAL-criticality = "critical"

################################################################################
# Event Logs & Network
################################################################################

[cyaudit:logsettings]
# Event log configuration
FIELDALIAS-log = LogName AS log_name
EVAL-category = "logging"
EVAL-log_type = "windows_eventlog"
EVAL-max_size_mb = round(MaximumSizeKB/1024, 2)

[cyaudit:shares]
# Network shares
FIELDALIAS-share = Name AS share_name
FIELDALIAS-share_path = Path AS share_path
EVAL-category = "network"
EVAL-share_type = case(Type=0, "disk", Type=1, "print", Type=2, "device", Type=3, "ipc", 1=1, "unknown")

################################################################################
# STIG Compliance Results
################################################################################

[cyaudit:stig_summary_v33]
# V3.3 STIG compliance checks
FIELDALIAS-stig_id = STIG_ID AS vulnerability_id
EVAL-category = "compliance"
EVAL-compliance_framework = "DISA_STIG_V33"
EVAL-severity = case(match(Category, "CAT.?I"), "critical", match(Category, "CAT.?II"), "high", match(Category, "CAT.?III"), "medium", 1=1, "informational")
EVAL-is_compliant = if(compliance_status="pass", "true", "false")

[cyaudit:stig_powerstig]
# PowerSTIG compliance checks
FIELDALIAS-stig_id = STIG_ID AS vulnerability_id
FIELDALIAS-resource = ResourceType AS resource_type
EVAL-category = "compliance"
EVAL-compliance_framework = "PowerSTIG"
EVAL-is_compliant = if(InDesiredState="true", "true", "false")
EVAL-check_method = "dsc"

[cyaudit:stig_comparison]
# V3.3 vs PowerSTIG comparison
FIELDALIAS-stig_id = STIG_ID AS vulnerability_id
EVAL-category = "compliance"
EVAL-compliance_framework = "STIG_Comparison"
EVAL-has_conflict = if(match(Comparison, "Conflict"), "true", "false")
EVAL-coverage = case(match(Comparison, "Both"), "both", match(Comparison, "V3.3 Only"), "v33_only", match(Comparison, "PowerSTIG Only"), "powerstig_only", 1=1, "unknown")

[cyaudit:stig_merged]
# Merged STIG results
FIELDALIAS-stig_id = STIG_ID AS vulnerability_id
EVAL-category = "compliance"
EVAL-compliance_framework = "STIG_Merged"
EVAL-severity = case(match(Category, "CAT.?I"), "critical", match(Category, "CAT.?II"), "high", match(Category, "CAT.?III"), "medium", 1=1, "informational")
EVAL-is_compliant = if(compliance_status="pass", "true", "false")

################################################################################
# Summary Reports
################################################################################

[cyaudit:enhanced_summary]
# Enhanced audit summary
EVAL-category = "summary"
EVAL-report_type = "enhanced"
EVAL-total_checks = V33_TotalChecks + PowerSTIG_TotalChecks
EVAL-combined_compliance_rate = round((PowerSTIG_Compliant / PowerSTIG_TotalChecks) * 100, 2)

[cyaudit:executive_summary]
# Executive summary (V3.3)
EVAL-category = "summary"
EVAL-report_type = "executive"
EVAL-compliance_score = OverallComplianceRate

################################################################################
# Audit Execution Logs
################################################################################

[cyaudit:errorlog]
# CyAudit execution log
EVAL-category = "audit_execution"
EVAL-severity = case(log_level="error", "high", log_level="warning", "medium", 1=1, "low")

################################################################################
# Field Extractions for Complex Fields
################################################################################

# Extract IP addresses from multi-value string (for systeminfo)
[cyaudit:systeminfo]
EVAL-ip_list = split(replace(IPAddresses, "[\\[\\]]", ""), ",")

# Extract members from multi-value array (already handled in transformation)
[cyaudit:groups]
EVAL-member_list = Members

# Extract assignees array
[cyaudit:userrights]
EVAL-assignee_list = Assignees

# Extract file system rights names array
[cyaudit:filepermissions]
EVAL-permission_list = FileSystemRightsNames

[cyaudit:dirpermissions]
EVAL-permission_list = FileSystemRightsNames

################################################################################
# Event Type Definitions (for tagging)
################################################################################

[cyaudit:*]
EVAL-event_category = case(
    category="system_info", "inventory",
    category="identity", "iam",
    category="security_policy", "policy",
    category="configuration", "change",
    category="permissions", "access",
    category="storage", "inventory",
    category="patching", "vulnerability",
    category="logging", "configuration",
    category="network", "network",
    category="compliance", "audit",
    category="summary", "report",
    category="audit_execution", "system",
    1=1, "other"
)

################################################################################
# CIM (Common Information Model) Compliance
################################################################################

# Change Analysis data model
[cyaudit:services]
FIELDALIAS-object = ServiceName AS object
FIELDALIAS-object_category = "service" AS object_category
EVAL-action = "read"
EVAL-change_type = "configuration"

[cyaudit:registry]
FIELDALIAS-object = RegistryKey AS object
FIELDALIAS-object_path = RegistryKey AS object_path
EVAL-object_category = "registry"
EVAL-action = "read"

# Vulnerabilities data model
[cyaudit:stig_*]
FIELDALIAS-signature = STIG_ID AS signature
FIELDALIAS-cve = STIG_ID AS cve
EVAL-vendor_product = "Microsoft Windows"

[cyaudit:missinghotfixes]
FIELDALIAS-signature = KBNum AS signature
EVAL-vendor_product = "Microsoft Windows"

# Identity Management data model
[cyaudit:users]
FIELDALIAS-identity = UserName AS identity
FIELDALIAS-user_id = SID AS user_id
EVAL-identity_type = "user"

[cyaudit:groups]
FIELDALIAS-identity = Name AS identity
FIELDALIAS-group_id = SID AS group_id
EVAL-identity_type = "group"
